# Dockerfile para desarrollo con hot-reload
FROM node:20-alpine

WORKDIR /app

# Instalar dependencias del sistema necesarias para compilación y timezone
RUN apk add --no-cache python3 make g++ tzdata

# Establecer timezone (ajustar según tu región)
ENV TZ=America/Guatemala
RUN cp /usr/share/zoneinfo/$TZ /etc/localtime && \
    echo $TZ > /etc/timezone

# Copiar archivos de configuración
COPY package.json package-lock.json* ./
COPY tsconfig.json tsconfig.base.json nest-cli.json ./

# Instalar todas las dependencias (incluyendo devDependencies)
RUN npm install

# Copiar código fuente
COPY apps ./apps
COPY libs ./libs

# Copiar script de entrada
COPY docker-entrypoint.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

# Exponer puertos (se sobrescribirán en docker-compose)
EXPOSE 3000 3001 3002

# Usar script de entrada
ENTRYPOINT ["sh", "/usr/local/bin/docker-entrypoint.sh"]

# Comando por defecto (se sobrescribirá en docker-compose)
CMD ["npm", "run", "start:admin"]

